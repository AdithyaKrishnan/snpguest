snpguest(1)
===========

NAME
----
snpguest - Command line tool for managing the AMD SEV-SNP Guest environment.


SYNOPSIS
--------
*snpguest* [GLOBAL_OPTIONS] [COMMAND] [COMMAND_ARGS] [SUBCOMMAND] [SUBCOMMAND_ARGS]
*snpguest* [_-h, --help_]


DESCRIPTION
-----------
snpguest is a CLI utility for navigating and interacting with the AMD SEV-SNP
guest firmware device of a guest system.


GLOBAL OPTIONS
--------------
*-q, --quiet*:: Don't print any output to the console.


COMMANDS
--------
*snpguest report*::
    usage: snpguest report [-e, --extended-report] [-r, --random] [-v, --vmpl] $VMPL [-d, --request-data] $REQUEST_FILE [-a, --att-report] $ATT_REPORT_PATH $CERTS_PATH
    
    Requests an attestation report from the host and writes it in a file with the provided request data and vmpl. 
    Will write the contents of the attestation report in binary format into the specified report path.
    If no path is provided for the attestation report, the path will default to current directory ("./attestation_report.bin").
    User can pass 64 bytes of data in any file format into --request-data in order to use that data to request the attestation report.
    The user can use the --random flag to generate and use random data for request data. 
    If the user provides a path using --request-data and also uses the --random flag, random data will be written into the provided file path.
    If the user uses the --random flag with no --request-data flag, then the data will be written into the default file in current directory ("./random-request-file.txt").
    VMPL defaults to 1.
    To request an extended-report, use the --extended-report flag.
    Extended-report stores the attestation report and also fetches the certificates stored by host in memory.
    If the --extended-report flag is used, the user needs to provide a path to the directory in which the certs will be stored.
    The certificates will be cycled through and placed into the specified directory.
    If no certs path is provided, an error will be raised.
    The certs will be stored in the same format as they were loaded by host (".pem" or ".der").
    If the certificates already exist in the provided directory, they will be overwritten.

    options:
    -h, --help  show a help message
    -e, --extended  request an extended report
    -r, --random  generate 64 random bytes of data to pass for the report request

*snpguest fetch ca*::
    usage: snpguest fetch ca $CERTS_DIR $PROCESSOR_MODEL

    Requests the certificate authority chain (ARK & ASK) from the KDS.
    The user must specify their host processor model.
    The user needs to provide the path to the directory where the certs will be stored.
    Both certificates will be written in ".pem" format.
    If the certificates already exist in the provided directory, they will be overwritten.

    options:
    -h, --help show a help message

*snpguest fetch vcek*::
    usage: snpguest fetch vcek $CERTS_DIR $PROCESSOR_MODEL [-a, --att-report] $ATT_REPORT_PATH

    Requests the VCEK certificate from the KDS.
    The user must specify their host processor model.
    The user needs to provide the path to the directory where the VCEK will be stored.
    If no path is provided for the attestation report, the program will request one with default parameter values and random request data.
    The attestation report won't be stored, and will only be used for the request.
    The certificate will be written into the provided directory.
    The VCEK will be written in ".der" format.
    If the certificate already exists in the provided directory, it will be overwritten.

    options:
    -h, --help show a help message

*snpguest fetch certs*::
    usage: snpguest fetch certs [-e, --extended-report] $CERTS_DIR $PROCESSOR_MODEL [-a, --att-report] $ATT_REPORT_PATH

    Requests the complete certificate chain (ASK, ARK & VCEK) from either the KDS or the host memory.
    If the --extended-report is used, then the certificates will be pulled from the host memory, if not it will default to the kds.
    The user must specify their host processor model for the kds request.
    The user needs to provide the path to the directory where the certs will be stored.
    If no path is provided for the attestation report for the kds request, the program will request one with default parameter values and random request data.
    The attestation report won't be stored for either request type.
    The certificates will be written into the provided directory.
    If --extended-report is used then the certs will be stored in the same format as they were loaded by host (".pem" or ".der").
    If the request is made through the kds, the ASK and the ARK will be stored in ".pem" and the VCEK in ".der".
    If the certificate already exists in the provided directory, it will be overwritten.

    options:
    -h, --help show a help message

*snpguest guest verify certs*::
    usage: snpguest verify certs $CERTS_DIR

    Verifies that the provided certificate chain has been properly signed by each certificate.
    The user needs to provide a directory were all 3 of the certificates are stored (ARK,ASK and VCEK).
    Error will be raised if any of the certificates fails verification.

    options:
    -h, --help show a help message

*snpguest verify tcb*::
    usage: snpguest verify tcb $CERTS_DIR [-a, --att-report] $ATT_REPORT_PATH

    Verifies the trusted compute base using an attestation report and VCEK certificate.
    The user needs to provide a path to the directory containing the VCEK certificate.
    If no path is provided for the attestation report, the program will request one with default parameter values and random request data.
    The attestation report won't be stored, and will only be used for the verification.
    Error will be raised if there is any mismatch between the report TCB and the VCEK TCB contents.

    options:
    -h, --help show a help message

*snpguest verify signature*::
    usage: snpguest verify signature $CERTS_DIR [-a, --att-report] $ATT_REPORT_PATH

    Verifies that the provided attestation report was signed by the VCEK.
    The user needs to provide a path to the directory containing the VCEK certificate.
    If no path is provided for the attestation report, the program will request one with default parameter values and random request data.
    The attestation report won't be stored, and will only be used for the verification.
    Error will be raised if the signature in the attestation report does not match the VCEK public key.

    options:
    -h, --help show a help message

*snpguest guest display report*::
    usage: snpguest display report [-a, --att-report] $ATT_REPORT_PATH

    Prints the attestation report contents into terminal.
    If no path is provided for the attestation report, the program will request one with default parameter values and random request data.
    The attestation report won't be stored, and will only be displayed.

    options:
    -h, --help show a help message

REPORTING BUGS
--------------

Please report all bugs to <https://github.com/virtee/snpguest/issues>
